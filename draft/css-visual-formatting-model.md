#可视化格式模型

规范：[visuren](http://www.w3.org/TR/CSS21/visuren.html)

##介绍
在该模型中，文档树中的每个元素都会生成 0 或多个盒子。这些盒子的布局由下列因素影响：

1. 盒尺寸和类型
2. 定位策略
3. 和文档树中其他元素的关系
4. 额外信息

###viewport
浏览器提供给用户的一个可以操作文档的区域。

如果视口小于文档渲染的画布，浏览器会生成滚动条。

每个画布最多有一个视口。但画布可能会有多个。

###Containing blocks 包含块
元素的位置会相对于包含块来计算。生成盒对于后代元素来说就像包含块一样。因此可以说一个盒子为它的后代元素"创建"了包含块。

"一个盒子的包含块"指的是该盒子所在的包含块，而不是它生成的包含块。

##Controlling box generation 生成控制盒
###Block-level elements and block boxes 块元素和块级盒
display 值为 "block"，"list-item"，"table"。

块级盒参与 BFC。每个块元素生成一个**主块级盒(principal block-level box)**，用于包含后代盒子和生成的内容，同时它也参与定位方案。

有些块元素会生成额外的块级盒，例如 'list-item' 元素。这些额外的块级盒会相对于主块级盒来放置。

除了 table 盒与替换元素外，一个块级盒同时还是一个**块容器盒(block container box)**。块容器盒要么只包含块级盒，要么创建一个**行内格式化上下文(inline formatting context)**从而只包含行级盒。并不是所有的块容器盒都是块级盒：非替换行内块和非替换表格单元都是块容器，但它们不是块级盒。

既是块级盒又是块容器的元素称之为**块盒(block box)**。

块级盒、块容器盒、块盒有时都称之为盒。

####Anonymous block boxes 匿名块盒
	<DIV>
	  Some text
	  <P>More text
	</DIV>

为了方便定义格式化，会认为在"Some text" 周围有一个匿名块盒。

换句话说：如果一个块容器盒包含一个块级盒，那么该容器盒便只能包含块级盒。

当一个行内盒包含一个处于文档流中的块级盒时，该行内盒会拆分为两个匿名块级盒放置于块级盒的两端。

涉及到百分比计算时不会考虑匿名盒，而是选择最近的非匿名祖先盒。

###Inline-level elements and inline boxes 行内元素和行内盒
行内元素 display 值为 "inline"，"inline-table"，"inline-block"。

行内元素生成行级块，它参与行内格式化上下文 IFC。

**行盒(inline box)**是指既为行级盒并且它的内容参与它所在的 IFC。不是行盒(例如可替换的行内元素，inline-block 元素，和 inline-table 元素)的行内盒称为**原子行级盒(atomic inline-level box)**，因为他们会作为一个完整的不透明盒参与 IFC。

####Anonymous inline boxes 匿名行内盒
如果文字直接包含在块容器元素内，那么该文字应当看做一个匿名行内元素。

匿名行内盒从父级块盒继承属性。

### 'display' 属性
- block：使元素生成块盒。
- inline-block：使元素生成一个行级块容器。内部类似于块盒来进行格式化，该元素表现为一个原子行级盒。
- inline：生成一个或多个行盒。
- list-item：使元素生成一个主级块盒和一个标记盒。
- none：使元素不出现于格式化结构中(元素不生成盒子，对布局无影响)。后代元素也不会生成任何盒子。
- table，inline-table……：使元素表现的像表格元素。

计算值和指定值相同，除了定位或浮动的元素(设置它们会影响 display 值)。

##定位方案
在 CSS 2.1 中，有三种定位方案：

1. 常规流：包含块级盒的块级格式化，行级盒的行级格式化，块级盒行级盒的相对定位。
2. 浮动：盒子先通过常规流布局，然后从常规流中取出并尽可能的远的向左或向右。
3. 绝对定位：盒子从常规流中完全移除，并相对一个包含块定位。

###'position' 属性
1.  static：在常规流中布局，top、right、bottom、left 不生效。
2.  relative：在常规流中布局，然后相对原始位置进行位移。
3.  absolute：根据元素所在的包含块定位。元素脱离常规流，即对后面的兄弟节点的布局不产生影响。绝对定位元素的 margin 不折叠。
4.  fixed：使用 absolute 模型计算布局，只不过元素相对于 viewport 定位。

##Normal flow 常规流
常规流中的盒子属于某个格式化上下文，块级盒属于一个块格式化上下文，行级盒属于一个行格式化上下文。
###Block formatting contexts 块格式化上下文
浮动，绝对定位元素，块容器(例如 inline-block，table-cells)不是块盒，'overflow'值不为'visible'的块盒会为它们的内容创建新的 BFC。

在 BFC 内，盒子们从上向下垂直排列。两个相邻盒子之间的距离由 margin 决定。

在 BFC 内，每个盒子的左外边缘紧贴包含块的左边缘。

###Inline formatting contexts 行格式化上下文
在 IFC 内，盒子们水平排列。

包含所有盒子的矩形区域成为**行盒(line box)**。

行盒总是足够高以便容纳所有内部的盒子。然而，它有可能比内部最高的盒子还要高。

如果单独的一个行盒无法容纳所有行级盒，那么这些盒子会被放置于两个或多个垂直叠加的行盒中。因此，一个段落是众多行盒的垂直堆叠，行盒之间没有间隙，并且它们永不重叠。

